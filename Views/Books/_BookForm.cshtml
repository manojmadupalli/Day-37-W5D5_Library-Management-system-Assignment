@model Book
@{
    var authors = ViewBag.Authors as IEnumerable<Author>;
    var genres = ViewBag.Genres as IEnumerable<Genre>;
    bool isNew = Model.Id == 0;
}
<form id="bookForm">
    <input type="hidden" name="Id" value="@Model.Id" />
    <div class="mb-3">
        <label class="form-label">Title</label>
        <input class="form-control" name="Title" value="@Model.Title" required maxlength="150" />
    </div>
    <div class="mb-3">
        <label class="form-label">Author</label>
        <select class="form-select" name="AuthorId" required>
            <option value="">--Select--</option>
            @foreach (var a in authors!)
            {
                <option value="@a.Id" selected="@(Model.AuthorId==a.Id)">@a.Name</option>

            }
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Genre</label>
        <select class="form-select" name="GenreId" required>
            <option value="">--Select--</option>
            @foreach (var g in genres!)
            {
                <option value="@g.Id" selected="@(Model.GenreId==g.Id)">@g.Name</option>
            }
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Published Year</label>
        <input type="number" class="form-control" name="PublishedYear" value="@Model.PublishedYear" min="1000" max="2100" />
    </div>
    <div class="d-flex justify-content-end gap-2">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">@((isNew)?"Create":"Update")</button>
    </div>
</form>
<script>
$(function(){
    $("#bookForm").off("submit").on("submit", function(e){
        e.preventDefault();
        const form = $(this);
        const url = @Model.Id==0 ? '/Books/Create' : '/Books/Edit/@Model.Id';
        $.ajax({
            url: url,
            type: 'POST',
            data: form.serialize(),
            success: function(res){
                if(res && res.success){
                    location.reload();
                } else {
                    alert('Validation failed');
                }
            },
            error: function(xhr){
                if(xhr.responseJSON){
                    alert(JSON.stringify(xhr.responseJSON));
                } else {
                    alert('Server error');
                }
            }
        });
    });
});
</script>
